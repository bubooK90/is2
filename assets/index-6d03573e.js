import{g as N,r as A,k as T,l as B,x as j,o as p,c as b,F as k,h as D,y as w,b as _,w as C,i as R,d as M,t as F}from"./index-dcd12ae9.js";import{r as P}from"./HeartIcon-08bf7f6d.js";const $=["onClick"],G={class:"w-full"},rt={__name:"Waterfall",props:{colnum:{type:Number,default:5},colwidth:{type:Number,default:320},gap:{type:Number,default:20}},setup(o,{expose:e}){const t=o,{proxy:r}=N(),i=A(0),n=A([]),s=A([]),c=A([]);e({updateWaterfall:a=>{c.value=a,E()}}),T(()=>{window.addEventListener("resize",y(O,50))}),B(()=>{window.removeEventListener("resize",y(O,50))});const v=a=>{var l=Math.min.apply(null,a);return a.indexOf(l)},y=(a,l)=>{let f;return function(){f&&clearTimeout(f),f=setTimeout(()=>{a()},l)}},O=()=>{const a=window.innerWidth,l=i.value;i.value=Math.min(Math.floor(a/t.colwidth),t.colnum),i.value=i.value?i.value:1,l!=i.value&&E()},E=()=>{n.value=[],s.value=[];for(var a=0;a<i.value;a++)n.value.push(0),s.value.push([]);const l=c.value.length;for(var a=0;a<l;a++){const g=Math.round(c.value[a].height*t.colwidth/c.value[a].width),d=v(n.value);s.value[d].push(a),n.value[d]+=g+t.gap}},z=a=>{r.$cookies.set("intelli-artwork",a),r.$util.gotoPage("artwork")};return O(),(a,l)=>{const f=j("lazy");return p(),b("div",{class:"min-h-[200px] mx-auto flex text-white",style:w("width:"+i.value*o.colwidth+"px")},[(p(!0),b(k,null,D(i.value,g=>(p(),b("div",{key:g,style:w("width:"+o.colwidth+"px")},[(p(!0),b(k,null,D(s.value[g-1],d=>(p(),b("div",{class:"w-full",key:d},[_("div",{class:"relative w-full",style:w("padding:"+o.gap/2+"px"),onClick:Z=>z(c.value[d].sn)},[C(_("img",G,null,512),[[f,R(r).$util.settings.api+"/d/image/"+c.value[d].file]]),_("div",{class:"absolute left-0 right-0 bottom-0 px-2 bg-gradient-to-t from-black/50 to-black/0 flex items-center",style:w("margin:"+o.gap/2+"px")},[M(R(P),{class:"w-4 h-4 mr-2"}),_("div",null,F(c.value[d].like),1)],4)],12,$)]))),128))],4))),128))],4)}}};var u=(o=>(o.LOADING="loading",o.LOADED="loaded",o.ERROR="error",o))(u||{});const U=typeof window<"u"&&window!==null,W=Q(),V=Object.prototype.propertyIsEnumerable,x=Object.getOwnPropertySymbols;function m(o){return typeof o=="function"||toString.call(o)==="[object Object]"}function H(o){return typeof o=="object"?o===null:typeof o!="function"}function K(o){return o!=="__proto__"&&o!=="constructor"&&o!=="prototype"}function Q(){return U&&"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype?("isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get(){return this.intersectionRatio>0}}),!0):!1}function q(o,...e){if(!m(o))throw new TypeError("expected the first argument to be an object");if(e.length===0||typeof Symbol!="function"||typeof x!="function")return o;for(const t of e){const r=x(t);for(const i of r)V.call(t,i)&&(o[i]=t[i])}return o}function L(o,...e){let t=0;for(H(o)&&(o=e[t++]),o||(o={});t<e.length;t++)if(m(e[t])){for(const r of Object.keys(e[t]))K(r)&&(m(o[r])&&m(e[t][r])?L(o[r],e[t][r]):o[r]=e[t][r]);q(o,e[t])}return o}const S="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",J="",X={rootMargin:"0px",threshold:0},h="data-lazy-timeout-id";class Y{constructor(e){this.options={loading:S,error:J,observerOptions:X,log:!0,lifecycle:{}},this._images=new WeakMap,this.config(e)}config(e={}){L(this.options,e)}mount(e,t){if(!e)return;const{src:r,loading:i,error:n,lifecycle:s,delay:c}=this._valueFormatter(typeof t=="string"?t:t.value);this._lifecycle(u.LOADING,s,e),e.setAttribute("src",i||S),W||(this.loadImages(e,r,n,s),this._log(()=>{throw new Error("Not support IntersectionObserver!")})),this._initIntersectionObserver(e,r,n,s,c)}update(e,t){var c;if(!e)return;(c=this._realObserver(e))==null||c.unobserve(e);const{src:r,error:i,lifecycle:n,delay:s}=this._valueFormatter(typeof t=="string"?t:t.value);this._initIntersectionObserver(e,r,i,n,s)}unmount(e){var t;e&&((t=this._realObserver(e))==null||t.unobserve(e),this._images.delete(e))}loadImages(e,t,r,i){this._setImageSrc(e,t,r,i)}_setImageSrc(e,t,r,i){e.tagName.toLowerCase()==="img"?(t&&e.getAttribute("src")!==t&&e.setAttribute("src",t),this._listenImageStatus(e,()=>{this._lifecycle(u.LOADED,i,e)},()=>{var n;e.onload=null,this._lifecycle(u.ERROR,i,e),(n=this._realObserver(e))==null||n.disconnect(),r&&e.getAttribute("src")!==r&&e.setAttribute("src",r),this._log(()=>{throw new Error(`Image failed to load!And failed src was: ${t} `)})})):e.style.backgroundImage=`url('${t}')`}_initIntersectionObserver(e,t,r,i,n){var c;const s=this.options.observerOptions;this._images.set(e,new IntersectionObserver(I=>{Array.prototype.forEach.call(I,v=>{n&&n>0?this._delayedIntersectionCallback(e,v,n,t,r,i):this._intersectionCallback(e,v,t,r,i)})},s)),(c=this._realObserver(e))==null||c.observe(e)}_intersectionCallback(e,t,r,i,n){var s;t.isIntersecting&&((s=this._realObserver(e))==null||s.unobserve(t.target),this._setImageSrc(e,r,i,n))}_delayedIntersectionCallback(e,t,r,i,n,s){if(t.isIntersecting){if(t.target.hasAttribute(h))return;const c=setTimeout(()=>{this._intersectionCallback(e,t,i,n,s),t.target.removeAttribute(h)},r);t.target.setAttribute(h,String(c))}else t.target.hasAttribute(h)&&(clearTimeout(Number(t.target.getAttribute(h))),t.target.removeAttribute(h))}_listenImageStatus(e,t,r){e.onload=t,e.onerror=r}_valueFormatter(e){let t=e,r=this.options.loading,i=this.options.error,n=this.options.lifecycle,s=this.options.delay;return m(e)&&(t=e.src,r=e.loading||this.options.loading,i=e.error||this.options.error,n=e.lifecycle||this.options.lifecycle,s=e.delay||this.options.delay),{src:t,loading:r,error:i,lifecycle:n,delay:s}}_log(e){this.options.log&&e()}_lifecycle(e,t,r){switch(e){case u.LOADING:r==null||r.setAttribute("lazy",u.LOADING),t!=null&&t.loading&&t.loading(r);break;case u.LOADED:r==null||r.setAttribute("lazy",u.LOADED),t!=null&&t.loaded&&t.loaded(r);break;case u.ERROR:r==null||r.setAttribute("lazy",u.ERROR),t!=null&&t.error&&t.error(r);break}}_realObserver(e){return this._images.get(e)}}const ot={install(o,e){const t=new Y(e);o.config.globalProperties.$Lazyload=t,o.provide("Lazyload",t),o.directive("lazy",{mounted:t.mount.bind(t),updated:t.update.bind(t),unmounted:t.unmount.bind(t)})}};export{rt as _,ot as i};
