import{g as V,r as h,m as _,p as F,z as O,o as g,c as f,a as l,t as p,n as C,i as I,A as w,F as B,l as N,w as q,f as k,b as j,q as J,s as P,e as m}from"./PageHeader-8744a40b.js";import{r as U}from"./EyeIcon-d72f0d9d.js";const G={class:"flex-1"},H={class:"text-3xl font-black"},K={class:"mt-2"},Q={key:0,class:"text-xs text-right text-stone-100"},R={key:0,class:"p-5 text-center"},X=["onClick"],Y={class:"w-full"},Z={class:"mr-2"},ee={class:"mr-2"},te={class:"mr-2"},oe={__name:"Waterfall",props:{title:{type:String,default:""},subtitle:{type:String,default:""},colmax:{type:String,default:"5"},colwidth:{type:String,default:"320"},gap:{type:String,default:"10"},filter:{type:String,default:"all"},sortable:{type:String,default:"true"}},setup(n,{expose:D}){const s=n,{proxy:u}=V(),S=!!localStorage.token,i=h(0),x=h([]),y=h([]),t=h([]),b=h("createtime"),v=h("");D({updateWaterfall:e=>{t.value=e,$()}}),_(()=>{window.addEventListener("resize",A(d,50))}),F(()=>{window.removeEventListener("resize",A(d,50))});const W=e=>{var a=Math.min.apply(null,e);return e.indexOf(a)},A=(e,a)=>{let r;return function(){r&&clearTimeout(r),r=setTimeout(()=>{e()},a)}},d=()=>{const e=window.innerWidth,a=i.value;i.value=Math.min(Math.floor(e/s.colwidth),s.colmax),i.value=i.value?i.value:1,a!=i.value&&$()},$=()=>{x.value=[],y.value=[];for(var e=0;e<i.value;e++)x.value.push(0),y.value.push([]);const a=t.value.length;for(var e=0;e<a;e++){const c=Math.round(t.value[e].height*s.colwidth/t.value[e].width),o=W(x.value);y.value[o].push(e),x.value[o]+=c+Number(s.gap)}},E=()=>{s.filter=="search"?m.post(u.$util.settings.api+"/search",JSON.stringify({keywords:localStorage.search}),{headers:{accept:"application/json","Content-Type":"application/json"}}).then(function(e){t.value=e.data.data,t.value.length==0&&(v.value="没有搜索到任何作品"),d()}).catch(function(e){console.log(e)}):s.filter=="artist"?m.get(u.$util.settings.api+"/artist/"+localStorage.artist+"/artworks",{headers:{accept:"application/json"}}).then(function(e){t.value=e.data,t.value.length==0&&(v.value="还没有发布任何作品"),d()}).catch(function(e){console.log(e)}):S&&s.filter=="collection"?m.get(u.$util.settings.api+"/my/collection",{headers:{Authorization:"Bearer "+localStorage.token,accept:"application/json"}}).then(function(e){t.value=e.data,t.value.length==0&&(v.value="你还没有收藏任何作品"),d()}).catch(function(e){console.log(e)}):S&&s.filter=="favorite"?m.get(u.$util.settings.api+"/my/favorite",{headers:{Authorization:"Bearer "+localStorage.token,accept:"application/json"}}).then(function(e){t.value=e.data,t.value.length==0&&(v.value="你还没有赞过任何作品"),d()}).catch(function(e){console.log(e)}):S&&s.filter=="gallery"?m.get(u.$util.settings.api+"/my/gallery",{headers:{Authorization:"Bearer "+localStorage.token,accept:"application/json"}}).then(function(e){t.value=e.data,t.value.length==0&&(v.value="你还没有上传任何作品"),d()}).catch(function(e){console.log(e)}):(v.value="",m.get(u.$util.settings.api+"/artworks/"+s.filter,{headers:{accept:"application/json"}}).then(function(e){t.value=e.data,t.value.length==0&&(v.value="此分类下暂无参赛作品"),d()}).catch(function(e){console.log(e)}))},z=e=>{b.value=e,t.value.sort(a(e)),$();function a(r){return function(c,o){var M=c[r],T=o[r];return T-M}}},L=e=>{var a=[];for(var r in t.value)a.push(t.value[r].sn);localStorage.setItem("artwork",e),localStorage.setItem("waterfall",a),u.$util.gotoPage("artwork")};return E(),(e,a)=>{const r=O("lazy");return g(),f(B,null,[l("div",{class:"mx-auto mt-10 mb-5 text-stone-900/80 flex items-end",style:w("min-width: "+n.colwidth+"px; width:"+i.value*n.colwidth+"px; padding: 0 "+n.gap+"px")},[l("div",G,[l("div",H,p(n.title),1),l("div",K,p(n.subtitle),1)]),n.sortable=="true"&&t.value.length>1?(g(),f("div",Q,[l("button",{class:C([b.value=="liked"?"bg-stone-600":"bg-stone-500","px-2 py-1 hover:bg-stone-600"]),onClick:a[0]||(a[0]=c=>z("liked"))},"最赞",2),l("button",{class:C([b.value=="viewed"?"bg-stone-600":"bg-stone-500","px-2 py-1 hover:bg-stone-600"]),onClick:a[1]||(a[1]=c=>z("viewed"))},"最热",2),l("button",{class:C([b.value=="createtime"?"bg-stone-600":"bg-stone-500","px-2 py-1 hover:bg-stone-600"]),onClick:a[2]||(a[2]=c=>z("createtime"))},"最新",2)])):I("",!0)],4),t.value.length==0?(g(),f("div",R,p(v.value),1)):I("",!0),l("div",{class:"mx-auto flex text-white/80 text-xs",style:w("width:"+i.value*n.colwidth+"px")},[(g(!0),f(B,null,N(i.value,c=>(g(),f("div",{style:w("width:"+n.colwidth+"px"),key:c},[(g(!0),f(B,null,N(y.value[c-1],o=>(g(),f("div",{class:"w-full",key:o},[l("div",{class:"relative w-full",style:w("padding:"+n.gap+"px"),onClick:M=>L(t.value[o].sn)},[q(l("img",Y,null,512),[[r,k(u).$util.settings.img+t.value[o].file]]),l("div",{class:"absolute left-0 right-0 bottom-0 py-1 bg-gradient-to-t from-black/50 to-black/0 text-white flex flex-row-reverse items-center",style:w("margin:"+n.gap+"px")},[l("div",Z,p(t.value[o].collected),1),j(k(J),{class:"w-4 h-4 mr-2"}),l("div",ee,p(t.value[o].liked),1),j(k(P),{class:"w-4 h-4 mr-2"}),l("div",te,p(t.value[o].viewed),1),j(k(U),{class:"w-4 h-4 mr-2"})],4)],12,X)]))),128))],4))),128))],4)],64)}}};export{oe as _};
